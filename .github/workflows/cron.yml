name: T20 Predict Cron

on:
  schedule:
    - cron: "*/20 * * * *" # Every 20 minutes
  workflow_dispatch: # Manual trigger

jobs:
  predict-claude:
    runs-on: ubuntu-latest
    steps:
      - name: Claude Opus prediction
        run: |
          curl -sf -X GET "${{ secrets.APP_URL }}/api/cron/predict?agentId=claude-opus" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
            --max-time 90

  predict-gpt:
    runs-on: ubuntu-latest
    steps:
      - name: GPT prediction
        run: |
          curl -sf -X GET "${{ secrets.APP_URL }}/api/cron/predict?agentId=gpt-5" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
            --max-time 90

  predict-gemini:
    runs-on: ubuntu-latest
    steps:
      - name: Gemini prediction
        run: |
          curl -sf -X GET "${{ secrets.APP_URL }}/api/cron/predict?agentId=gemini-3" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
            --max-time 90

  predict-grok:
    runs-on: ubuntu-latest
    steps:
      - name: Grok prediction
        run: |
          curl -sf -X GET "${{ secrets.APP_URL }}/api/cron/predict?agentId=grok" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
            --max-time 90

  check-results:
    runs-on: ubuntu-latest
    steps:
      - name: Check and settle completed matches
        run: |
          curl -sf -X GET "${{ secrets.APP_URL }}/api/cron/results" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
            --max-time 90

  check-team-news:
    runs-on: ubuntu-latest
    steps:
      - name: Check for playing XI / toss announcements
        run: |
          curl -sf -X GET "${{ secrets.APP_URL }}/api/cron/team-news" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
            --max-time 90
